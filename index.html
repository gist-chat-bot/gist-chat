<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a1a2e">
    <title>Gist</title>
    
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Top Bar -->
    <header class="app-header">
        <button class="menu-btn" id="menu-btn">
            <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
        </button>
        <h1 class="app-title">Gist</h1>
        <div class="sync-status" id="sync-status">
            <span class="status-dot"></span>
            <span class="status-text">Offline</span>
        </div>
    </header>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">?</div>
                    <div class="user-details">
                        <span class="user-name" id="user-name">--</span>
                        <span class="user-status">Online</span>
                    </div>
                </div>
                <button class="logout-btn" id="logout-btn">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
                </button>
            </div>

            <div class="sidebar-section">
                <div class="section-header">
                    <h3>Messages</h3>
                    <span class="section-count" id="dm-count">0/5</span>
                </div>
                <div class="slots-list" id="dm-slots"></div>
                <button class="add-slot-btn" id="add-dm-btn">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    New Chat
                </button>
            </div>

            <div class="sidebar-section">
                <div class="section-header">
                    <h3>Groups</h3>
                    <span class="section-count" id="gc-count">0/2</span>
                </div>
                <div class="slots-list" id="gc-slots"></div>
                <button class="add-slot-btn" id="add-gc-btn">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    New Group
                </button>
            </div>

            <div class="sidebar-section">
                <button class="menu-item" id="search-btn">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
                    Search Users
                </button>
                <button class="menu-item" id="settings-btn">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/></svg>
                    Settings
                </button>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-main">
            <div class="chat-header" id="chat-header">
                <div class="chat-info">
                    <div class="chat-avatar" id="chat-avatar">?</div>
                    <div class="chat-details">
                        <span class="chat-name" id="chat-name">Select a chat</span>
                        <span class="chat-status" id="chat-status">--</span>
                    </div>
                </div>
                <button class="chat-options" id="chat-options">
                    <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12 16c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0-6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0-6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2Z"/></svg>
                </button>
            </div>

            <div class="message-list" id="message-list">
                <div class="welcome-message">
                    <div class="welcome-icon">ðŸ’¬</div>
                    <h2>Welcome to Gist</h2>
                    <p>Encrypted. Private. Yours.</p>
                    <p class="welcome-sub">Select a chat or start a new conversation</p>
                </div>
            </div>

            <div class="input-area">
                <button class="input-btn" id="attach-btn" title="Attach">
                    <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 0 1 5 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 0 0 5 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5Z"/></svg>
                </button>
                <input type="text" class="message-input" id="message-input" placeholder="Message" disabled autocomplete="off">
                <button class="input-btn" id="emoji-btn" title="Emoji">
                    <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5m-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11m3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5Z"/></svg>
                </button>
                <button class="send-btn" id="send-btn" disabled>
                    <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M2 21l21-9L2 3v7l15 2-15 2v7Z"/></svg>
                    <span class="cooldown-timer" id="cooldown-timer"></span>
                </button>
            </div>
        </main>
    </div>

    <!-- Auth Modal -->
    <div class="modal" id="auth-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="auth-title">Welcome to Gist</h2>
                <p class="modal-subtitle">Secure. Encrypted. Private.</p>
            </div>
            
            <div class="auth-form">
                <div class="form-group">
                    <label>User ID</label>
                    <input type="text" id="auth-id-input" placeholder="e.g. A1" maxlength="10">
                </div>
                <div class="form-group">
                    <label>Passphrase</label>
                    <input type="password" id="auth-pass-input" placeholder="Your secret passphrase">
                </div>
                <button class="btn-primary" id="auth-action-btn">Continue</button>
                <p class="auth-toggle" id="auth-toggle">Have an account? Login</p>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div class="modal" id="search-modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Search Users</h2>
                <button class="modal-close" id="search-close-btn">
                    <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
                </button>
            </div>
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Enter User ID (e.g. A1)">
                <button class="btn-primary" id="search-action-btn">Search</button>
            </div>
            <div class="search-result" id="search-result"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" id="settings-close-btn">
                    <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
                </button>
            </div>
            <div class="settings-list">
                <div class="setting-item">
                    <span>Clear All Messages</span>
                    <button class="btn-danger" id="clear-messages-btn">Clear</button>
                </div>
                <div class="setting-item">
                    <span>Export Keys</span>
                    <button class="btn-secondary" id="export-keys-btn">Export</button>
                </div>
                <div class="setting-item">
                    <span>App Version</span>
                    <span class="setting-value">2.0.0</span>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="crypto.js"></script>
    <script src="db.js"></script>
    <script src="script.js"></script>
    <script>
    // Debug: Check what's loaded
    console.log("=== DEBUG INFO ===");
    console.log("CONFIG:", typeof CONFIG);
    console.log("CryptoModule:", typeof CryptoModule);
    console.log("DB:", typeof DB);
    console.log("supabase:", typeof window.supabase);
    
    if (typeof DB === 'undefined') {
        alert("DB not loaded! Check console for errors");
    }
    </script>
</body>
</html>
